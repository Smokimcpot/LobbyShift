<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LobbyShift</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d0d0d;
            --bg-secondary: #141414;
            --bg-card: #1a1a1a;
            --bg-card-hover: #222222;
            --accent: #ff9800;
            --accent-bright: #ffb74d;
            --accent-dark: #e65100;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --text-muted: #555555;
            --border: #2a2a2a;
            --border-accent: #ff980033;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            position: relative;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 152, 0, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 152, 0, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            position: relative;
            border-bottom: 2px solid var(--accent);
        }
        
        header::before {
            content: "";
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: var(--accent);
        }
        
        .logo {
            font-family: 'Teko', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 8px;
            margin-bottom: 5px;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        .tagline {
            font-family: 'Teko', sans-serif;
            color: var(--text-secondary);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 4px;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            margin-bottom: 20px;
            position: relative;
            clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 12px 100%, 0 calc(100% - 12px));
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            background: rgba(255, 152, 0, 0.03);
        }
        
        .card-header.collapsible {
            cursor: pointer;
            user-select: none;
        }
        
        .card-header.collapsible:hover {
            background: rgba(255, 152, 0, 0.06);
        }
        
        .card-title {
            font-family: 'Teko', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title::before {
            content: "‚ñ∂";
            font-size: 0.7rem;
        }
        
        .collapse-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }
        
        .card-body {
            padding: 20px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        
        .card-body.collapsed {
            max-height: 0;
            padding: 0 20px;
        }
        
        .card-header.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        
        /* Active Config Summary (shown when collapsed) */
        .active-summary {
            display: none;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(76, 175, 80, 0.05);
            border-top: 1px solid var(--border);
        }
        
        .active-summary.visible {
            display: flex;
        }
        
        .active-summary .config-flag {
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 2px 4px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .active-summary .config-info {
            flex: 1;
        }
        
        .active-summary .config-name {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .active-summary .config-meta {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .active-summary .config-time {
            color: var(--accent);
            font-family: 'Teko', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 1px;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            font-family: 'Teko', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
            clip-path: polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px);
        }
        
        .status-badge.active {
            border-color: var(--success);
            color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }
        
        .status-badge.inactive {
            border-color: var(--text-muted);
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.02);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Status Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent);
            padding: 12px 15px;
        }
        
        .status-item label {
            display: block;
            font-family: 'Teko', sans-serif;
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        
        .status-item value {
            display: block;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        /* Region Time Display */
        .region-time {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(255, 152, 0, 0.05) 100%);
            border: 1px solid var(--border-accent);
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .region-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .region-flag {
            font-size: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 4px 6px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .region-details h3 {
            font-family: 'Teko', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
        }
        
        .region-details span {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .region-clock {
            text-align: right;
        }
        
        .region-clock .time {
            font-family: 'Teko', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 2px;
        }
        
        .region-clock .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Buttons */
        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            font-family: 'Teko', sans-serif;
            padding: 10px 20px;
            border: 1px solid;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: transparent;
            clip-path: polygon(6px 0, 100% 0, 100% calc(100% - 6px), calc(100% - 6px) 100%, 0 100%, 0 6px);
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .btn-primary {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(255, 152, 0, 0.1);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--accent);
            color: var(--bg-primary);
        }
        
        .btn-danger {
            border-color: var(--danger);
            color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: var(--danger);
            color: var(--bg-primary);
        }
        
        .btn-secondary {
            border-color: var(--text-muted);
            color: var(--text-secondary);
        }
        
        .btn-secondary:hover:not(:disabled) {
            border-color: var(--text-secondary);
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* Config List */
        .config-list {
            display: grid;
            gap: 8px;
        }
        
        .config-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 15px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .config-item:hover {
            border-color: var(--accent);
            background: var(--bg-card-hover);
        }
        
        .config-item.active {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.05);
        }
        
        .config-item.active::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--success);
        }
        
        .config-item.favorite {
            border-color: var(--accent);
        }
        
        .config-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.2s;
            clip-path: none;
        }
        
        .favorite-btn:hover {
            transform: scale(1.2);
        }
        
        .config-details {
            flex: 1;
        }
        
        .config-name {
            font-weight: 700;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .config-flag {
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 2px 4px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .config-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 4px;
        }
        
        .config-endpoint {
            font-size: 0.85rem;
            color: var(--text-primary);
            font-family: monospace;
        }
        
        .config-time {
            font-size: 1rem;
            color: var(--accent);
            font-family: 'Teko', sans-serif;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .config-actions {
            display: flex;
            gap: 6px;
        }
        
        .config-actions button {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        /* Upload Zone */
        .upload-zone {
            background: var(--bg-secondary);
            border: 2px dashed var(--border);
            padding: 35px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--accent);
            background: rgba(255, 152, 0, 0.05);
        }
        
        .upload-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .upload-text {
            color: var(--text-secondary);
        }
        
        .upload-text strong {
            color: var(--accent);
        }
        
        #file-input {
            display: none;
        }
        
        /* Logs */
        .logs-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            max-height: 250px;
            overflow-y: auto;
        }
        
        .logs-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .logs-container::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        .logs-container::-webkit-scrollbar-thumb {
            background: var(--accent);
        }
        
        .log-entry {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-icon.connected {
            color: var(--success);
        }
        
        .log-action {
            color: var(--text-secondary);
        }
        
        .log-config {
            color: var(--accent);
            font-weight: 600;
        }
        
        .log-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: monospace;
        }
        
        .empty-logs {
            padding: 30px;
            text-align: center;
            color: var(--text-muted);
        }
        
        /* Setup Info */
        .setup-info {
            background: var(--bg-card);
            border: 1px solid var(--accent);
            border-left: 4px solid var(--accent);
            padding: 20px;
            margin-top: 20px;
        }
        
        .setup-info h3 {
            font-family: 'Teko', sans-serif;
            color: var(--accent);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.2rem;
        }
        
        .setup-steps {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        .setup-steps code {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 2px 8px;
            color: var(--accent);
            font-family: monospace;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--accent);
            padding: 0;
            width: 90%;
            max-width: 550px;
            max-height: 80vh;
            overflow-y: auto;
            clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px));
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 152, 0, 0.1);
            border-bottom: 1px solid var(--border);
        }
        
        .modal-header h3 {
            font-family: 'Teko', sans-serif;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            clip-path: none;
        }
        
        .modal-close:hover {
            color: var(--danger);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        textarea {
            width: 100%;
            min-height: 280px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--success);
            padding: 15px;
            font-family: monospace;
            font-size: 0.85rem;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            font-family: 'Teko', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
            border-left: 3px solid;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: var(--bg-card);
            border-color: var(--success);
            color: var(--success);
        }
        
        .toast.error {
            background: var(--bg-card);
            border-color: var(--danger);
            color: var(--danger);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 25px 20px;
            margin-top: 30px;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
        }
        
        .footer a {
            color: var(--accent);
            text-decoration: none;
        }
        
        .footer a:hover {
            color: var(--accent-bright);
        }
        
        /* Settings */
        .settings-form {
            display: grid;
            gap: 20px;
        }
        
        .setting-group {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 20px;
        }
        
        .setting-group h4 {
            font-family: 'Teko', sans-serif;
            font-size: 1.1rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .setting-row:last-child {
            margin-bottom: 0;
        }
        
        .setting-row label {
            font-weight: 600;
            min-width: 120px;
            color: var(--text-secondary);
        }
        
        .setting-row input[type="text"] {
            flex: 1;
            max-width: 200px;
            padding: 10px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: monospace;
            font-size: 1rem;
        }
        
        .setting-row input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .setting-row input[type="text"]::placeholder {
            color: var(--text-muted);
        }
        
        .setting-select {
            flex: 1;
            max-width: 250px;
            padding: 10px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .setting-select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .setting-select option {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: 0.3s;
        }
        
        .toggle-slider::before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: var(--text-muted);
            transition: 0.3s;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background: rgba(255, 152, 0, 0.2);
            border-color: var(--accent);
        }
        
        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(30px);
            background: var(--accent);
        }
        
        .toggle-status {
            font-family: 'Teko', sans-serif;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .toggle-status.active {
            color: var(--success);
        }
        
        .toggle-status.inactive {
            color: var(--text-muted);
        }
        
        .warning-box {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--accent);
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin-top: 15px;
        }
        
        .warning-box h5 {
            font-family: 'Teko', sans-serif;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .warning-box p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .warning-box code {
            background: var(--bg-card);
            padding: 2px 6px;
            color: var(--accent);
            font-family: monospace;
        }
        
        .warning-box ul {
            margin: 10px 0 0 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .warning-box li {
            margin-bottom: 5px;
        }
        
        .settings-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .autostart-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            margin-bottom: 15px;
        }
        
        .autostart-status.active {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }
        
        .autostart-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-muted);
        }
        
        .autostart-status.active .autostart-status-dot {
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        /* Config Names List */
        .config-names-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .config-name-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
        }
        
        .config-name-item .config-original {
            min-width: 150px;
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .config-name-item .config-original .flag {
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            padding: 2px 3px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .config-name-item .arrow {
            color: var(--accent);
            font-size: 1.2rem;
        }
        
        .config-name-item input {
            flex: 1;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .config-name-item input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .config-name-item input::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            .logo { font-size: 2.2rem; letter-spacing: 4px; }
            .card-header { flex-direction: row; gap: 10px; align-items: center; }
            .card-header.collapsed .collapse-icon { transform: rotate(-90deg); }
            .status-grid { grid-template-columns: 1fr; }
            .actions { flex-direction: column; }
            .config-item { flex-direction: column; gap: 12px; align-items: flex-start; }
            .config-actions { width: 100%; }
            .config-actions button { flex: 1; }
            .region-time { flex-direction: column; gap: 15px; text-align: center; }
            .region-clock { text-align: center; }
            .config-meta { flex-direction: column; align-items: flex-start; gap: 5px; }
            .active-summary { 
                flex-direction: row; 
                text-align: left; 
                padding: 12px 15px;
                gap: 12px;
            }
            .active-summary .config-flag { font-size: 1rem; }
            .active-summary .config-info { flex: 1; }
            .active-summary .config-name { font-size: 1rem; }
            .active-summary .config-meta { 
                flex-direction: row; 
                flex-wrap: wrap;
                gap: 8px;
                font-size: 0.8rem;
            }
            .setting-row { flex-direction: column; align-items: flex-start; gap: 10px; }
            .setting-row label { min-width: auto; }
            .setting-row input[type="text"], .setting-select { max-width: 100%; width: 100%; }
            .config-name-item { flex-direction: column; align-items: stretch; gap: 8px; }
            .config-name-item .config-original { min-width: auto; }
            .config-name-item .arrow { display: none; }
            .config-name-item input { width: 100%; }
            .settings-actions { flex-direction: column; }
            .settings-actions button { width: 100%; }
            .warning-box ul { margin-left: 15px; }
            .language-selector { position: static; margin-bottom: 15px; }
        }
        
        /* Language Selector */
        .language-selector {
            position: absolute;
            top: 30px;
            right: 0;
        }
        
        .language-selector select {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 6px 10px;
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            clip-path: polygon(6px 0, 100% 0, 100% calc(100% - 6px), calc(100% - 6px) 100%, 0 100%, 0 6px);
        }
        
        .language-selector select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .language-selector select option {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        /* Twemoji flag sizing */
        img.emoji {
            height: 1em;
            width: 1em;
            margin: 0 .05em 0 .1em;
            vertical-align: -0.1em;
        }
        
        .config-flag img.emoji {
            height: 1.3em;
            width: 1.3em;
        }
        
        .active-summary .config-flag img.emoji {
            height: 1.2em;
            width: 1.2em;
        }
        
        .region-flag img.emoji {
            height: 1.8em;
            width: 1.8em;
        }
        
        .config-name-item .flag img.emoji {
            height: 1.1em;
            width: 1.1em;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="language-selector">
                <select id="language-select" onchange="changeLanguage(this.value)">
                    <option value="en">üá¨üáß EN</option>
                    <option value="de">üá©üá™ DE</option>
                    <option value="fr">üá´üá∑ FR</option>
                    <option value="it">üáÆüáπ IT</option>
                    <option value="es">üá™üá∏ ES</option>
                </select>
            </div>
            <div class="logo">LOBBY<span>SHIFT</span></div>
            <div class="tagline" data-i18n="tagline">Tactical Matchmaking Control</div>
        </header>
        
        <!-- Region Time Display -->
        <div class="region-time" id="region-time-display" style="display: none;">
            <div class="region-info">
                <span class="region-flag" id="region-flag">üåç</span>
                <div class="region-details">
                    <h3 id="region-name">-</h3>
                    <span id="region-timezone">-</span>
                </div>
            </div>
            <div class="region-clock">
                <div class="time" id="region-clock-time">--:--</div>
                <div class="label">Local Time</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-title" data-i18n="systemStatus">System Status</div>
                <div id="status-badge" class="status-badge inactive">
                    <span class="status-dot"></span>
                    <span id="status-text">Offline</span>
                </div>
            </div>
            <div class="card-body">
                <div class="status-grid">
                    <div class="status-item">
                        <label data-i18n="activeConfig">Active Config</label>
                        <value id="active-config">-</value>
                    </div>
                    <div class="status-item">
                        <label data-i18n="endpoint">Endpoint</label>
                        <value id="endpoint">-</value>
                    </div>
                    <div class="status-item">
                        <label data-i18n="lastHandshake">Last Handshake</label>
                        <value id="handshake">-</value>
                    </div>
                    <div class="status-item">
                        <label data-i18n="transfer">Transfer</label>
                        <value id="transfer">-</value>
                    </div>
                </div>
                
                <div class="actions">
                    <button id="btn-start" class="btn-primary" onclick="startVPN()" data-i18n="deployVpn">Deploy VPN</button>
                    <button id="btn-stop" class="btn-danger" onclick="stopVPN()" data-i18n="disconnect">Disconnect</button>
                    <button class="btn-secondary" onclick="refreshStatus()" data-i18n="refresh">Refresh</button>
                </div>
            </div>
        </div>
        
        <div class="card" id="regions-card">
            <div class="card-header collapsible" onclick="toggleSection('regions')">
                <div class="card-title" data-i18n="vpnRegions">VPN Regions</div>
                <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="active-summary" id="regions-summary">
                <!-- Shown when collapsed -->
            </div>
            <div class="card-body" id="regions-body">
                <div id="config-list" class="config-list"></div>
                
                <div class="upload-zone" id="upload-zone" onclick="event.stopPropagation(); document.getElementById('file-input').click()">
                    <div class="upload-icon">üì°</div>
                    <div class="upload-text">
                        <strong data-i18n="deployNewRegion">Deploy New Region</strong><br>
                        <span data-i18n="dropConfig">Drop WireGuard config here</span>
                    </div>
                </div>
                <input type="file" id="file-input" accept=".conf" onchange="uploadConfig(this.files[0])">
                
                <button class="btn-secondary refresh-flags-btn" onclick="event.stopPropagation(); refreshFlags()" style="margin-top: 10px; width: 100%;">
                    üîÑ <span data-i18n="refreshFlags">Refresh Flags</span>
                </button>
            </div>
        </div>
        
        <div class="card" id="logs-card">
            <div class="card-header collapsible collapsed" onclick="toggleSection('logs')">
                <div class="card-title" data-i18n="operationLog">Operation Log</div>
                <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="card-body collapsed" id="logs-body">
                <div id="logs-container" class="logs-container"></div>
            </div>
        </div>
        
        <div class="card" id="settings-card">
            <div class="card-header collapsible collapsed" onclick="toggleSection('settings')">
                <div class="card-title" data-i18n="settings">Settings</div>
                <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="card-body collapsed" id="settings-body">
                <div class="settings-form">
                    <div class="setting-group">
                        <h4>üöÄ <span data-i18n="autostartConfig">Autostart Configuration</span></h4>
                        
                        <div class="autostart-status" id="autostart-status">
                            <span class="autostart-status-dot"></span>
                            <span id="autostart-status-text" data-i18n="autostartDisabled">Autostart Disabled</span>
                        </div>
                        
                        <div class="setting-row">
                            <label data-i18n="enable">Enable:</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autostart-toggle" onchange="toggleAutostartPreview()">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-status inactive" id="autostart-toggle-status">OFF</span>
                        </div>
                        
                        <div class="setting-row">
                            <label data-i18n="region">Region:</label>
                            <select id="autostart-config" class="setting-select">
                                <option value="" data-i18n="selectConfig">-- Select Config --</option>
                            </select>
                        </div>
                        
                        <div class="warning-box" style="border-color: var(--success); background: rgba(76, 175, 80, 0.1);">
                            <h5 style="color: var(--success);">üí° <span data-i18n="info">Info</span></h5>
                            <p data-i18n="autostartInfo">When enabled, LobbyShift will automatically connect to the selected VPN region when the server starts or reboots.</p>
                        </div>
                        
                        <div class="settings-actions">
                            <button class="btn-primary" onclick="saveAutostartSettings()">üíæ <span data-i18n="saveSettings">Save Settings</span></button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h4>üè∑Ô∏è <span data-i18n="customNames">Custom Region Names</span></h4>
                        
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;" data-i18n="customNamesDesc">
                            Give your VPN configs friendly names (e.g. "Bot Lobbies" instead of "mx-free-47")
                        </p>
                        
                        <div id="config-names-list" class="config-names-list">
                            <!-- Populated by JavaScript -->
                        </div>
                        
                        <div class="settings-actions">
                            <button class="btn-primary" onclick="saveConfigNames()">üíæ <span data-i18n="saveNames">Save Names</span></button>
                            <button class="btn-secondary" onclick="clearAllNames()">üóëÔ∏è <span data-i18n="clearAll">Clear All</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="setup-info">
            <h3>‚öô <span data-i18n="consoleConfig">Console Configuration</span></h3>
            <div class="setup-steps">
                <p data-i18n="consoleConfigDesc">Set your PS5/Xbox network gateway to this server:</p>
                <p style="margin-top: 10px;">
                    <strong data-i18n="gateway">Gateway:</strong> <code>{{ server_ip }}</code><br>
                    <strong data-i18n="dns">DNS:</strong> <code>8.8.8.8</code> <span data-i18n="orRouterIp">or your router IP</span>
                </p>
            </div>
        </div>
        
        <footer class="footer">
            Made with ‚ù§Ô∏è by <a href="https://github.com/Smokimcpot" target="_blank">Smokimcpot</a>
        </footer>
    </div>
    
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title" data-i18n="editConfig">Edit Config</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="config-editor"></textarea>
                <div class="actions" style="margin-top: 15px;">
                    <button class="btn-primary" onclick="saveConfig()" data-i18n="save">Save</button>
                    <button class="btn-secondary" onclick="closeModal()" data-i18n="cancel">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="info-modal" class="modal">
        <div class="modal-content" style="max-width: 420px;">
            <div class="modal-header">
                <h3 id="info-modal-title">Info</h3>
                <button class="modal-close" onclick="closeInfoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="info-modal-body" style="color: var(--text-secondary); line-height: 1.8;"></div>
                <div class="actions" style="margin-top: 20px;">
                    <button class="btn-primary" onclick="closeInfoModal()" data-i18n="rogerThat">Roger That</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>
    
    <script>
        let currentEditConfig = null;
        let currentRegionTimezone = null;
        let allConfigs = [];
        let configNames = {};
        let currentLang = localStorage.getItem('lobbyshift_lang') || 'en';
        
        // Translations
        const translations = {
            en: {
                tagline: "Tactical Matchmaking Control",
                systemStatus: "System Status",
                online: "Online",
                offline: "Offline",
                activeConfig: "Active Config",
                endpoint: "Endpoint",
                lastHandshake: "Last Handshake",
                transfer: "Transfer",
                deployVpn: "Deploy VPN",
                disconnect: "Disconnect",
                refresh: "Refresh",
                vpnRegions: "VPN Regions",
                noActiveRegion: "No active region",
                noRegions: "No regions deployed. Upload a WireGuard config to begin.",
                deployNewRegion: "Deploy New Region",
                dropConfig: "Drop WireGuard config here",
                refreshFlags: "Refresh Flags",
                operationLog: "Operation Log",
                noLogs: "No operations logged",
                settings: "Settings",
                autostartConfig: "Autostart Configuration",
                autostartDisabled: "Autostart Disabled",
                enable: "Enable",
                region: "Region",
                selectConfig: "-- Select Config --",
                autostartInfo: "When enabled, LobbyShift will automatically connect to the selected VPN region when the server starts or reboots.",
                saveSettings: "Save Settings",
                customNames: "Custom Region Names",
                customNamesDesc: "Give your VPN configs friendly names (e.g. \"Bot Lobbies\" instead of \"mx-free-47\")",
                enterCustomName: "Enter custom name...",
                saveNames: "Save Names",
                clearAll: "Clear All",
                consoleConfig: "Console Configuration",
                consoleConfigDesc: "Set your PS5/Xbox network gateway to this server:",
                gateway: "Gateway",
                dns: "DNS",
                orRouterIp: "or your router IP",
                deploy: "Deploy",
                active: "Active",
                edit: "Edit",
                delete: "Delete",
                editConfig: "Edit Config",
                save: "Save",
                cancel: "Cancel",
                missionUpdated: "Mission Updated",
                regionDeployed: "Region deployed successfully!",
                restartGame: "Restart your game to apply new matchmaking region.",
                newLobbies: "New lobbies will use the updated location.",
                rogerThat: "Roger That",
                localTime: "Local Time",
                info: "Info",
                deployedTo: "Deployed to",
                disconnectedFrom: "Disconnected from"
            },
            de: {
                tagline: "Taktische Matchmaking-Steuerung",
                systemStatus: "Systemstatus",
                online: "Online",
                offline: "Offline",
                activeConfig: "Aktive Konfiguration",
                endpoint: "Endpunkt",
                lastHandshake: "Letzter Handshake",
                transfer: "√úbertragung",
                deployVpn: "VPN Starten",
                disconnect: "Trennen",
                refresh: "Aktualisieren",
                vpnRegions: "VPN Regionen",
                noActiveRegion: "Keine aktive Region",
                noRegions: "Keine Regionen vorhanden. Lade eine WireGuard-Konfiguration hoch.",
                deployNewRegion: "Neue Region hinzuf√ºgen",
                dropConfig: "WireGuard-Konfiguration hier ablegen",
                refreshFlags: "Flaggen aktualisieren",
                operationLog: "Verbindungsprotokoll",
                noLogs: "Keine Eintr√§ge vorhanden",
                settings: "Einstellungen",
                autostartConfig: "Autostart-Konfiguration",
                autostartDisabled: "Autostart deaktiviert",
                enable: "Aktivieren",
                region: "Region",
                selectConfig: "-- Konfiguration w√§hlen --",
                autostartInfo: "Wenn aktiviert, verbindet sich LobbyShift automatisch mit der gew√§hlten VPN-Region beim Serverstart.",
                saveSettings: "Einstellungen speichern",
                customNames: "Benutzerdefinierte Namen",
                customNamesDesc: "Gib deinen VPN-Konfigurationen eigene Namen (z.B. \"Bot Lobbies\" statt \"mx-free-47\")",
                enterCustomName: "Namen eingeben...",
                saveNames: "Namen speichern",
                clearAll: "Alle l√∂schen",
                consoleConfig: "Konsolen-Konfiguration",
                consoleConfigDesc: "Setze das Gateway deiner PS5/Xbox auf diesen Server:",
                gateway: "Gateway",
                dns: "DNS",
                orRouterIp: "oder deine Router-IP",
                deploy: "Aktivieren",
                active: "Aktiv",
                edit: "Bearbeiten",
                delete: "L√∂schen",
                editConfig: "Konfiguration bearbeiten",
                save: "Speichern",
                cancel: "Abbrechen",
                missionUpdated: "Region gewechselt",
                regionDeployed: "Region erfolgreich aktiviert!",
                restartGame: "Starte dein Spiel neu, um die neue Matchmaking-Region zu √ºbernehmen.",
                newLobbies: "Neue Lobbys werden den aktualisierten Standort verwenden.",
                rogerThat: "Verstanden",
                localTime: "Ortszeit",
                info: "Info",
                deployedTo: "Verbunden mit",
                disconnectedFrom: "Getrennt von"
            },
            fr: {
                tagline: "Contr√¥le Tactique du Matchmaking",
                systemStatus: "√âtat du Syst√®me",
                online: "En ligne",
                offline: "Hors ligne",
                activeConfig: "Config Active",
                endpoint: "Point d'acc√®s",
                lastHandshake: "Derni√®re connexion",
                transfer: "Transfert",
                deployVpn: "D√©marrer VPN",
                disconnect: "D√©connecter",
                refresh: "Actualiser",
                vpnRegions: "R√©gions VPN",
                noActiveRegion: "Aucune r√©gion active",
                noRegions: "Aucune r√©gion. T√©l√©chargez une config WireGuard.",
                deployNewRegion: "Ajouter une R√©gion",
                dropConfig: "D√©posez la config WireGuard ici",
                refreshFlags: "Actualiser les drapeaux",
                operationLog: "Journal des Op√©rations",
                noLogs: "Aucune op√©ration enregistr√©e",
                settings: "Param√®tres",
                autostartConfig: "Configuration Autostart",
                autostartDisabled: "Autostart d√©sactiv√©",
                enable: "Activer",
                region: "R√©gion",
                selectConfig: "-- Choisir config --",
                autostartInfo: "Si activ√©, LobbyShift se connectera automatiquement √† la r√©gion VPN s√©lectionn√©e au d√©marrage du serveur.",
                saveSettings: "Enregistrer",
                customNames: "Noms Personnalis√©s",
                customNamesDesc: "Donnez des noms √† vos configs VPN (ex: \"Bot Lobbies\" au lieu de \"mx-free-47\")",
                enterCustomName: "Entrer un nom...",
                saveNames: "Enregistrer Noms",
                clearAll: "Tout Effacer",
                consoleConfig: "Configuration Console",
                consoleConfigDesc: "D√©finissez la passerelle de votre PS5/Xbox sur ce serveur:",
                gateway: "Passerelle",
                dns: "DNS",
                orRouterIp: "ou l'IP de votre routeur",
                deploy: "D√©ployer",
                active: "Actif",
                edit: "Modifier",
                delete: "Supprimer",
                editConfig: "Modifier Config",
                save: "Enregistrer",
                cancel: "Annuler",
                missionUpdated: "R√©gion Chang√©e",
                regionDeployed: "R√©gion d√©ploy√©e avec succ√®s!",
                restartGame: "Red√©marrez votre jeu pour appliquer la nouvelle r√©gion.",
                newLobbies: "Les nouveaux lobbies utiliseront le nouvel emplacement.",
                rogerThat: "Compris",
                localTime: "Heure Locale",
                info: "Info",
                deployedTo: "Connect√© √†",
                disconnectedFrom: "D√©connect√© de"
            },
            it: {
                tagline: "Controllo Tattico del Matchmaking",
                systemStatus: "Stato Sistema",
                online: "Online",
                offline: "Offline",
                activeConfig: "Config Attiva",
                endpoint: "Endpoint",
                lastHandshake: "Ultimo Handshake",
                transfer: "Trasferimento",
                deployVpn: "Avvia VPN",
                disconnect: "Disconnetti",
                refresh: "Aggiorna",
                vpnRegions: "Regioni VPN",
                noActiveRegion: "Nessuna regione attiva",
                noRegions: "Nessuna regione. Carica una config WireGuard.",
                deployNewRegion: "Aggiungi Regione",
                dropConfig: "Trascina la config WireGuard qui",
                refreshFlags: "Aggiorna bandiere",
                operationLog: "Registro Operazioni",
                noLogs: "Nessuna operazione registrata",
                settings: "Impostazioni",
                autostartConfig: "Configurazione Autostart",
                autostartDisabled: "Autostart disabilitato",
                enable: "Attiva",
                region: "Regione",
                selectConfig: "-- Seleziona config --",
                autostartInfo: "Se abilitato, LobbyShift si connetter√† automaticamente alla regione VPN selezionata all'avvio del server.",
                saveSettings: "Salva Impostazioni",
                customNames: "Nomi Personalizzati",
                customNamesDesc: "Dai nomi alle tue config VPN (es: \"Bot Lobbies\" invece di \"mx-free-47\")",
                enterCustomName: "Inserisci nome...",
                saveNames: "Salva Nomi",
                clearAll: "Cancella Tutto",
                consoleConfig: "Configurazione Console",
                consoleConfigDesc: "Imposta il gateway della tua PS5/Xbox su questo server:",
                gateway: "Gateway",
                dns: "DNS",
                orRouterIp: "o l'IP del tuo router",
                deploy: "Attiva",
                active: "Attivo",
                edit: "Modifica",
                delete: "Elimina",
                editConfig: "Modifica Config",
                save: "Salva",
                cancel: "Annulla",
                missionUpdated: "Regione Cambiata",
                regionDeployed: "Regione attivata con successo!",
                restartGame: "Riavvia il gioco per applicare la nuova regione.",
                newLobbies: "Le nuove lobby useranno la nuova posizione.",
                rogerThat: "Capito",
                localTime: "Ora Locale",
                info: "Info",
                deployedTo: "Connesso a",
                disconnectedFrom: "Disconnesso da"
            },
            es: {
                tagline: "Control T√°ctico de Matchmaking",
                systemStatus: "Estado del Sistema",
                online: "En l√≠nea",
                offline: "Desconectado",
                activeConfig: "Config Activa",
                endpoint: "Punto de acceso",
                lastHandshake: "√öltima conexi√≥n",
                transfer: "Transferencia",
                deployVpn: "Iniciar VPN",
                disconnect: "Desconectar",
                refresh: "Actualizar",
                vpnRegions: "Regiones VPN",
                noActiveRegion: "Sin regi√≥n activa",
                noRegions: "Sin regiones. Sube una config WireGuard.",
                deployNewRegion: "A√±adir Regi√≥n",
                dropConfig: "Arrastra la config WireGuard aqu√≠",
                refreshFlags: "Actualizar banderas",
                operationLog: "Registro de Operaciones",
                noLogs: "Sin operaciones registradas",
                settings: "Configuraci√≥n",
                autostartConfig: "Configuraci√≥n Autostart",
                autostartDisabled: "Autostart desactivado",
                enable: "Activar",
                region: "Regi√≥n",
                selectConfig: "-- Seleccionar config --",
                autostartInfo: "Si est√° activado, LobbyShift se conectar√° autom√°ticamente a la regi√≥n VPN seleccionada al iniciar el servidor.",
                saveSettings: "Guardar Configuraci√≥n",
                customNames: "Nombres Personalizados",
                customNamesDesc: "Dale nombres a tus configs VPN (ej: \"Bot Lobbies\" en vez de \"mx-free-47\")",
                enterCustomName: "Introducir nombre...",
                saveNames: "Guardar Nombres",
                clearAll: "Borrar Todo",
                consoleConfig: "Configuraci√≥n de Consola",
                consoleConfigDesc: "Configura el gateway de tu PS5/Xbox a este servidor:",
                gateway: "Gateway",
                dns: "DNS",
                orRouterIp: "o la IP de tu router",
                deploy: "Activar",
                active: "Activo",
                edit: "Editar",
                delete: "Eliminar",
                editConfig: "Editar Config",
                save: "Guardar",
                cancel: "Cancelar",
                missionUpdated: "Regi√≥n Cambiada",
                regionDeployed: "¬°Regi√≥n activada con √©xito!",
                restartGame: "Reinicia tu juego para aplicar la nueva regi√≥n.",
                newLobbies: "Los nuevos lobbies usar√°n la nueva ubicaci√≥n.",
                rogerThat: "Entendido",
                localTime: "Hora Local",
                info: "Info",
                deployedTo: "Conectado a",
                disconnectedFrom: "Desconectado de"
            }
        };
        
        function t(key) {
            return translations[currentLang]?.[key] || translations['en'][key] || key;
        }
        
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lobbyshift_lang', lang);
            document.getElementById('language-select').value = lang;
            updateAllTranslations();
        }
        
        function updateAllTranslations() {
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            
            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });
            
            // Re-render dynamic content
            if (allConfigs.length > 0) {
                renderConfigs(allConfigs);
                updateActiveSummary();
            }
            renderLogs(lastLogs || []);
            if (settingsLoaded) {
                renderConfigNamesList(lastAvailableConfigs || []);
            }
        }
        
        let lastLogs = [];
        let lastAvailableConfigs = [];
        let settingsLoaded = false;
        
        // Country to timezone mapping
        const countryTimezones = {
            // A
            'AF': 'Asia/Kabul', 'Afghanistan': 'Asia/Kabul',
            'AL': 'Europe/Tirane', 'Albania': 'Europe/Tirane',
            'DZ': 'Africa/Algiers', 'Algeria': 'Africa/Algiers',
            'AO': 'Africa/Luanda', 'Angola': 'Africa/Luanda',
            'AR': 'America/Argentina/Buenos_Aires', 'Argentina': 'America/Argentina/Buenos_Aires',
            'AM': 'Asia/Yerevan', 'Armenia': 'Asia/Yerevan',
            'AU': 'Australia/Sydney', 'Australia': 'Australia/Sydney',
            'AT': 'Europe/Vienna', 'Austria': 'Europe/Vienna',
            'AZ': 'Asia/Baku', 'Azerbaijan': 'Asia/Baku',
            // B
            'BH': 'Asia/Bahrain', 'Bahrain': 'Asia/Bahrain',
            'BD': 'Asia/Dhaka', 'Bangladesh': 'Asia/Dhaka',
            'BY': 'Europe/Minsk', 'Belarus': 'Europe/Minsk',
            'BE': 'Europe/Brussels', 'Belgium': 'Europe/Brussels',
            'BZ': 'America/Belize', 'Belize': 'America/Belize',
            'BO': 'America/La_Paz', 'Bolivia': 'America/La_Paz',
            'BA': 'Europe/Sarajevo', 'Bosnia and Herzegovina': 'Europe/Sarajevo',
            'BW': 'Africa/Gaborone', 'Botswana': 'Africa/Gaborone',
            'BR': 'America/Sao_Paulo', 'Brazil': 'America/Sao_Paulo',
            'BN': 'Asia/Brunei', 'Brunei': 'Asia/Brunei',
            'BG': 'Europe/Sofia', 'Bulgaria': 'Europe/Sofia',
            // C
            'KH': 'Asia/Phnom_Penh', 'Cambodia': 'Asia/Phnom_Penh',
            'CM': 'Africa/Douala', 'Cameroon': 'Africa/Douala',
            'CA': 'America/Toronto', 'Canada': 'America/Toronto',
            'CL': 'America/Santiago', 'Chile': 'America/Santiago',
            'CN': 'Asia/Shanghai', 'China': 'Asia/Shanghai',
            'CO': 'America/Bogota', 'Colombia': 'America/Bogota',
            'CR': 'America/Costa_Rica', 'Costa Rica': 'America/Costa_Rica',
            'HR': 'Europe/Zagreb', 'Croatia': 'Europe/Zagreb',
            'CU': 'America/Havana', 'Cuba': 'America/Havana',
            'CY': 'Asia/Nicosia', 'Cyprus': 'Asia/Nicosia',
            'CZ': 'Europe/Prague', 'Czech Republic': 'Europe/Prague', 'Czechia': 'Europe/Prague',
            // D
            'DK': 'Europe/Copenhagen', 'Denmark': 'Europe/Copenhagen',
            'DO': 'America/Santo_Domingo', 'Dominican Republic': 'America/Santo_Domingo',
            // E
            'EC': 'America/Guayaquil', 'Ecuador': 'America/Guayaquil',
            'EG': 'Africa/Cairo', 'Egypt': 'Africa/Cairo',
            'SV': 'America/El_Salvador', 'El Salvador': 'America/El_Salvador',
            'EE': 'Europe/Tallinn', 'Estonia': 'Europe/Tallinn',
            'ET': 'Africa/Addis_Ababa', 'Ethiopia': 'Africa/Addis_Ababa',
            // F
            'FI': 'Europe/Helsinki', 'Finland': 'Europe/Helsinki',
            'FR': 'Europe/Paris', 'France': 'Europe/Paris',
            // G
            'GE': 'Asia/Tbilisi', 'Georgia': 'Asia/Tbilisi',
            'DE': 'Europe/Berlin', 'Germany': 'Europe/Berlin',
            'GH': 'Africa/Accra', 'Ghana': 'Africa/Accra',
            'GR': 'Europe/Athens', 'Greece': 'Europe/Athens',
            'GT': 'America/Guatemala', 'Guatemala': 'America/Guatemala',
            // H
            'HN': 'America/Tegucigalpa', 'Honduras': 'America/Tegucigalpa',
            'HK': 'Asia/Hong_Kong', 'Hong Kong': 'Asia/Hong_Kong',
            'HU': 'Europe/Budapest', 'Hungary': 'Europe/Budapest',
            // I
            'IS': 'Atlantic/Reykjavik', 'Iceland': 'Atlantic/Reykjavik',
            'IN': 'Asia/Kolkata', 'India': 'Asia/Kolkata',
            'ID': 'Asia/Jakarta', 'Indonesia': 'Asia/Jakarta',
            'IR': 'Asia/Tehran', 'Iran': 'Asia/Tehran',
            'IQ': 'Asia/Baghdad', 'Iraq': 'Asia/Baghdad',
            'IE': 'Europe/Dublin', 'Ireland': 'Europe/Dublin',
            'IL': 'Asia/Jerusalem', 'Israel': 'Asia/Jerusalem',
            'IT': 'Europe/Rome', 'Italy': 'Europe/Rome',
            // J
            'JM': 'America/Jamaica', 'Jamaica': 'America/Jamaica',
            'JP': 'Asia/Tokyo', 'Japan': 'Asia/Tokyo',
            'JO': 'Asia/Amman', 'Jordan': 'Asia/Amman',
            // K
            'KZ': 'Asia/Almaty', 'Kazakhstan': 'Asia/Almaty',
            'KE': 'Africa/Nairobi', 'Kenya': 'Africa/Nairobi',
            'KW': 'Asia/Kuwait', 'Kuwait': 'Asia/Kuwait',
            'KG': 'Asia/Bishkek', 'Kyrgyzstan': 'Asia/Bishkek',
            'KR': 'Asia/Seoul', 'South Korea': 'Asia/Seoul', 'Korea': 'Asia/Seoul',
            // L
            'LA': 'Asia/Vientiane', 'Laos': 'Asia/Vientiane',
            'LV': 'Europe/Riga', 'Latvia': 'Europe/Riga',
            'LB': 'Asia/Beirut', 'Lebanon': 'Asia/Beirut',
            'LY': 'Africa/Tripoli', 'Libya': 'Africa/Tripoli',
            'LI': 'Europe/Vaduz', 'Liechtenstein': 'Europe/Vaduz',
            'LT': 'Europe/Vilnius', 'Lithuania': 'Europe/Vilnius',
            'LU': 'Europe/Luxembourg', 'Luxembourg': 'Europe/Luxembourg',
            // M
            'MO': 'Asia/Macau', 'Macau': 'Asia/Macau',
            'MY': 'Asia/Kuala_Lumpur', 'Malaysia': 'Asia/Kuala_Lumpur',
            'MV': 'Indian/Maldives', 'Maldives': 'Indian/Maldives',
            'MT': 'Europe/Malta', 'Malta': 'Europe/Malta',
            'MX': 'America/Mexico_City', 'Mexico': 'America/Mexico_City',
            'MD': 'Europe/Chisinau', 'Moldova': 'Europe/Chisinau',
            'MC': 'Europe/Monaco', 'Monaco': 'Europe/Monaco',
            'MN': 'Asia/Ulaanbaatar', 'Mongolia': 'Asia/Ulaanbaatar',
            'ME': 'Europe/Podgorica', 'Montenegro': 'Europe/Podgorica',
            'MA': 'Africa/Casablanca', 'Morocco': 'Africa/Casablanca',
            'MZ': 'Africa/Maputo', 'Mozambique': 'Africa/Maputo',
            'MM': 'Asia/Yangon', 'Myanmar': 'Asia/Yangon',
            // N
            'NA': 'Africa/Windhoek', 'Namibia': 'Africa/Windhoek',
            'NP': 'Asia/Kathmandu', 'Nepal': 'Asia/Kathmandu',
            'NL': 'Europe/Amsterdam', 'Netherlands': 'Europe/Amsterdam',
            'NZ': 'Pacific/Auckland', 'New Zealand': 'Pacific/Auckland',
            'NI': 'America/Managua', 'Nicaragua': 'America/Managua',
            'NG': 'Africa/Lagos', 'Nigeria': 'Africa/Lagos',
            'MK': 'Europe/Skopje', 'North Macedonia': 'Europe/Skopje',
            'NO': 'Europe/Oslo', 'Norway': 'Europe/Oslo',
            // O
            'OM': 'Asia/Muscat', 'Oman': 'Asia/Muscat',
            // P
            'PK': 'Asia/Karachi', 'Pakistan': 'Asia/Karachi',
            'PS': 'Asia/Gaza', 'Palestine': 'Asia/Gaza',
            'PA': 'America/Panama', 'Panama': 'America/Panama',
            'PY': 'America/Asuncion', 'Paraguay': 'America/Asuncion',
            'PE': 'America/Lima', 'Peru': 'America/Lima',
            'PH': 'Asia/Manila', 'Philippines': 'Asia/Manila',
            'PL': 'Europe/Warsaw', 'Poland': 'Europe/Warsaw',
            'PT': 'Europe/Lisbon', 'Portugal': 'Europe/Lisbon',
            'PR': 'America/Puerto_Rico', 'Puerto Rico': 'America/Puerto_Rico',
            // Q
            'QA': 'Asia/Qatar', 'Qatar': 'Asia/Qatar',
            // R
            'RO': 'Europe/Bucharest', 'Romania': 'Europe/Bucharest',
            'RU': 'Europe/Moscow', 'Russia': 'Europe/Moscow',
            'RW': 'Africa/Kigali', 'Rwanda': 'Africa/Kigali',
            // S
            'SA': 'Asia/Riyadh', 'Saudi Arabia': 'Asia/Riyadh',
            'SN': 'Africa/Dakar', 'Senegal': 'Africa/Dakar',
            'RS': 'Europe/Belgrade', 'Serbia': 'Europe/Belgrade',
            'SG': 'Asia/Singapore', 'Singapore': 'Asia/Singapore',
            'SK': 'Europe/Bratislava', 'Slovakia': 'Europe/Bratislava',
            'SI': 'Europe/Ljubljana', 'Slovenia': 'Europe/Ljubljana',
            'ZA': 'Africa/Johannesburg', 'South Africa': 'Africa/Johannesburg',
            'ES': 'Europe/Madrid', 'Spain': 'Europe/Madrid',
            'LK': 'Asia/Colombo', 'Sri Lanka': 'Asia/Colombo',
            'SD': 'Africa/Khartoum', 'Sudan': 'Africa/Khartoum',
            'SE': 'Europe/Stockholm', 'Sweden': 'Europe/Stockholm',
            'CH': 'Europe/Zurich', 'Switzerland': 'Europe/Zurich',
            'SY': 'Asia/Damascus', 'Syria': 'Asia/Damascus',
            // T
            'TW': 'Asia/Taipei', 'Taiwan': 'Asia/Taipei',
            'TJ': 'Asia/Dushanbe', 'Tajikistan': 'Asia/Dushanbe',
            'TZ': 'Africa/Dar_es_Salaam', 'Tanzania': 'Africa/Dar_es_Salaam',
            'TH': 'Asia/Bangkok', 'Thailand': 'Asia/Bangkok',
            'TN': 'Africa/Tunis', 'Tunisia': 'Africa/Tunis',
            'TR': 'Europe/Istanbul', 'Turkey': 'Europe/Istanbul',
            'TM': 'Asia/Ashgabat', 'Turkmenistan': 'Asia/Ashgabat',
            // U
            'UG': 'Africa/Kampala', 'Uganda': 'Africa/Kampala',
            'UA': 'Europe/Kiev', 'Ukraine': 'Europe/Kiev',
            'AE': 'Asia/Dubai', 'UAE': 'Asia/Dubai', 'United Arab Emirates': 'Asia/Dubai',
            'GB': 'Europe/London', 'UK': 'Europe/London', 'United Kingdom': 'Europe/London',
            'US': 'America/New_York', 'USA': 'America/New_York', 'United States': 'America/New_York',
            'UY': 'America/Montevideo', 'Uruguay': 'America/Montevideo',
            'UZ': 'Asia/Tashkent', 'Uzbekistan': 'Asia/Tashkent',
            // V
            'VE': 'America/Caracas', 'Venezuela': 'America/Caracas',
            'VN': 'Asia/Ho_Chi_Minh', 'Vietnam': 'Asia/Ho_Chi_Minh',
            // Y
            'YE': 'Asia/Aden', 'Yemen': 'Asia/Aden',
            // Z
            'ZM': 'Africa/Lusaka', 'Zambia': 'Africa/Lusaka',
            'ZW': 'Africa/Harare', 'Zimbabwe': 'Africa/Harare'
        };
        
        function getTimezoneForCountry(countryName) {
            if (!countryName) return null;
            return countryTimezones[countryName] || null;
        }
        
        function getLocalTimeForCountry(countryName) {
            const timezone = getTimezoneForCountry(countryName);
            if (!timezone) return null;
            try {
                return new Date().toLocaleTimeString('en-US', {
                    timeZone: timezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return null;
            }
        }
        
        function updateRegionClock() {
            if (!currentRegionTimezone) return;
            try {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', {
                    timeZone: currentRegionTimezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                document.getElementById('region-clock-time').textContent = timeStr;
            } catch (e) {
                console.error('Failed to update clock:', e);
            }
        }
        
        function updateRegionDisplay(config) {
            const display = document.getElementById('region-time-display');
            
            if (!config || !config.country) {
                display.style.display = 'none';
                currentRegionTimezone = null;
                return;
            }
            
            const timezone = getTimezoneForCountry(config.country.name);
            if (!timezone) {
                display.style.display = 'none';
                currentRegionTimezone = null;
                return;
            }
            
            currentRegionTimezone = timezone;
            display.style.display = 'flex';
            document.getElementById('region-flag').textContent = config.country.flag || 'üåç';
            document.getElementById('region-name').textContent = config.country.name;
            document.getElementById('region-timezone').textContent = timezone.replace('_', ' ');
            updateRegionClock();
        }
        
        function toggleSection(section) {
            const header = document.querySelector(`#${section}-card .card-header`);
            const body = document.getElementById(`${section}-body`);
            const summary = document.getElementById(`${section}-summary`);
            
            header.classList.toggle('collapsed');
            body.classList.toggle('collapsed');
            
            if (summary) {
                summary.classList.toggle('visible', header.classList.contains('collapsed'));
            }
        }
        
        function updateActiveSummary() {
            const summary = document.getElementById('regions-summary');
            const activeConfig = allConfigs.find(c => c.active);
            
            if (!activeConfig) {
                summary.innerHTML = `<span style="color: var(--text-muted);">${t('noActiveRegion')}</span>`;
                return;
            }
            
            const localTime = getLocalTimeForCountry(activeConfig.country?.name);
            const customName = configNames[activeConfig.name];
            const displayName = customName || activeConfig.country?.name || 'Unknown';
            const showOriginal = customName ? activeConfig.name : null;
            
            summary.innerHTML = `
                <span class="config-flag">${activeConfig.country?.flag || 'üåç'}</span>
                <div class="config-info">
                    <div class="config-name">${displayName}${showOriginal ? ` (${showOriginal})` : ''}</div>
                    <div class="config-meta">
                        <span class="config-endpoint">${activeConfig.endpoint}</span>
                        ${localTime ? `<span class="config-time">üïê ${localTime}</span>` : ''}
                    </div>
                </div>
            `;
            
            // Parse emojis with Twemoji
            if (typeof twemoji !== 'undefined') {
                twemoji.parse(summary);
            }
        }
        
        async function api(endpoint, method = 'GET', body = null) {
            const options = { method };
            if (body) {
                if (body instanceof FormData) {
                    options.body = body;
                } else {
                    options.headers = { 'Content-Type': 'application/json' };
                    options.body = JSON.stringify(body);
                }
            }
            const response = await fetch(`/api${endpoint}`, options);
            return response.json();
        }
        
        async function refreshStatus() {
            try {
                const status = await api('/status');
                updateStatusUI(status);
            } catch (e) {
                console.error('Failed to refresh status:', e);
            }
        }
        
        function updateStatusUI(status) {
            const badge = document.getElementById('status-badge');
            const statusText = document.getElementById('status-text');
            const activeConfig = document.getElementById('active-config');
            const endpoint = document.getElementById('endpoint');
            const handshake = document.getElementById('handshake');
            const transfer = document.getElementById('transfer');
            const btnStart = document.getElementById('btn-start');
            const btnStop = document.getElementById('btn-stop');
            
            if (status.active) {
                badge.className = 'status-badge active';
                statusText.textContent = 'Online';
                activeConfig.textContent = status.config || '-';
                endpoint.textContent = status.endpoint || '-';
                handshake.textContent = status.latest_handshake || '-';
                transfer.textContent = status.transfer_rx && status.transfer_tx 
                    ? `‚Üì ${status.transfer_rx} / ‚Üë ${status.transfer_tx}` : '-';
                btnStart.disabled = true;
                btnStop.disabled = false;
            } else {
                badge.className = 'status-badge inactive';
                statusText.textContent = 'Offline';
                activeConfig.textContent = '-';
                endpoint.textContent = '-';
                handshake.textContent = '-';
                transfer.textContent = '-';
                btnStart.disabled = false;
                btnStop.disabled = true;
                updateRegionDisplay(null);
            }
        }
        
        async function loadConfigs() {
            try {
                const data = await api('/configs');
                allConfigs = data.configs;
                renderConfigs(allConfigs);
                updateActiveSummary();
                
                // Update region display for active config
                const activeConfig = allConfigs.find(c => c.active);
                updateRegionDisplay(activeConfig);
            } catch (e) {
                console.error('Failed to load configs:', e);
            }
        }
        
        async function refreshFlags() {
            try {
                showToast('Refreshing flags...', 'success');
                // Clear GeoIP cache to force re-lookup
                await api('/geoip-cache', 'DELETE');
                // Reload configs to trigger fresh GeoIP lookups
                await loadConfigs();
                showToast('Flags refreshed!', 'success');
            } catch (e) {
                showToast('Failed to refresh flags', 'error');
                console.error('Failed to refresh flags:', e);
            }
        }
        
        function renderConfigs(configs) {
            const list = document.getElementById('config-list');
            
            if (configs.length === 0) {
                list.innerHTML = `<p style="color: var(--text-muted); text-align: center; padding: 20px;">${t('noRegions')}</p>`;
                return;
            }
            
            configs.sort((a, b) => {
                if (a.favorite && !b.favorite) return -1;
                if (!a.favorite && b.favorite) return 1;
                if (a.active && !b.active) return -1;
                if (!a.active && b.active) return 1;
                return 0;
            });
            
            list.innerHTML = configs.map(config => {
                const localTime = getLocalTimeForCountry(config.country?.name);
                const customName = configNames[config.name];
                const displayName = customName || config.country?.name || 'Unknown';
                const showOriginal = customName ? config.name : null;
                
                return `
                <div class="config-item ${config.active ? 'active' : ''} ${config.favorite ? 'favorite' : ''}">
                    <div class="config-info">
                        <button class="favorite-btn ${config.favorite ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavorite('${config.name}')" title="${config.favorite ? 'Remove from favorites' : 'Add to favorites'}">
                            ${config.favorite ? '‚≠ê' : '‚òÜ'}
                        </button>
                        <div class="config-details">
                            <div class="config-name">
                                <span class="config-flag">${config.country?.flag || 'üåç'}</span>
                                ${displayName}
                                ${showOriginal ? `<span style="color: var(--text-muted); font-weight: 400;">(${showOriginal})</span>` : ''}
                                ${config.active ? ' ‚úì' : ''}
                            </div>
                            <div class="config-meta">
                                <span class="config-endpoint">${config.endpoint}</span>
                                ${localTime ? `<span class="config-time">üïê ${localTime}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="config-actions">
                        <button class="btn-primary" onclick="event.stopPropagation(); switchConfig('${config.name}')" ${config.active ? 'disabled' : ''}>
                            ${config.active ? t('active') : t('deploy')}
                        </button>
                        <button class="btn-secondary" onclick="event.stopPropagation(); editConfig('${config.name}')">${t('edit')}</button>
                        <button class="btn-danger" onclick="event.stopPropagation(); deleteConfig('${config.name}')">${t('delete')}</button>
                    </div>
                </div>
            `}).join('');
            
            // Parse emojis with Twemoji for cross-browser flag support
            if (typeof twemoji !== 'undefined') {
                twemoji.parse(list);
            }
        }
        
        async function toggleFavorite(name) {
            try {
                const config = allConfigs.find(c => c.name === name);
                if (config?.favorite) {
                    await api(`/favorites/${name}`, 'DELETE');
                } else {
                    await api(`/favorites/${name}`, 'POST');
                }
                await loadConfigs();
            } catch (e) {
                showToast('Failed to update favorite', 'error');
            }
        }
        
        async function loadLogs() {
            try {
                const data = await api('/logs');
                renderLogs(data.logs);
            } catch (e) {
                console.error('Failed to load logs:', e);
            }
        }
        
        function renderLogs(logs) {
            lastLogs = logs;
            const container = document.getElementById('logs-container');
            if (!logs || logs.length === 0) {
                container.innerHTML = `<div class="empty-logs">${t('noLogs')}</div>`;
                return;
            }
            container.innerHTML = logs.slice(0, 20).map(log => {
                const date = new Date(log.timestamp);
                const timeStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                const icon = log.action === 'connected' ? 'üü¢' : '‚ö™';
                const iconClass = log.action === 'connected' ? 'connected' : '';
                return `
                    <div class="log-entry">
                        <span class="log-icon ${iconClass}">${icon}</span>
                        <div class="log-details">
                            <div>
                                <span class="log-action">${log.action === 'connected' ? t('deployedTo') : t('disconnectedFrom')}</span>
                                <span class="log-config">${log.config || 'Unknown'}</span>
                            </div>
                            ${log.details ? `<div class="log-extra">${log.details}</div>` : ''}
                            <div class="log-time">${timeStr}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Parse emojis with Twemoji
            if (typeof twemoji !== 'undefined') {
                twemoji.parse(container);
            }
        }
        
        async function clearLogs() {
            if (!confirm('Clear all operation logs?')) return;
            try {
                await api('/logs', 'DELETE');
                await loadLogs();
                showToast('Logs cleared', 'success');
            } catch (e) {
                showToast('Failed to clear logs', 'error');
            }
        }
        
        async function startVPN() {
            try {
                showToast('Deploying VPN...', 'success');
                await api('/up', 'POST');
                await refreshStatus();
                await loadConfigs();
                await loadLogs();
                showToast('VPN Online', 'success');
            } catch (e) {
                showToast('Deployment failed', 'error');
            }
        }
        
        async function stopVPN() {
            try {
                await api('/down', 'POST');
                await refreshStatus();
                await loadConfigs();
                await loadLogs();
                showToast('VPN Disconnected', 'success');
            } catch (e) {
                showToast('Disconnect failed', 'error');
            }
        }
        
        async function switchConfig(name) {
            try {
                showToast(`${t('deploy')}...`, 'success');
                await api(`/switch/${name}`, 'POST');
                await refreshStatus();
                await loadConfigs();
                await loadLogs();
                showModal(t('missionUpdated'), `${t('regionDeployed')}<br><br>‚ö†Ô∏è <strong>${t('restartGame')}</strong><br><br>${t('newLobbies')}`);
            } catch (e) {
                showToast('Deployment failed', 'error');
            }
        }
        
        async function editConfig(name) {
            try {
                const data = await api(`/configs/${name}`);
                currentEditConfig = name;
                document.getElementById('modal-title').textContent = `${t('edit')}: ${name}`;
                document.getElementById('config-editor').value = data.content;
                document.getElementById('edit-modal').classList.add('active');
            } catch (e) {
                showToast('Failed to load config', 'error');
            }
        }
        
        async function saveConfig() {
            if (!currentEditConfig) return;
            try {
                const content = document.getElementById('config-editor').value;
                await api(`/configs/${currentEditConfig}`, 'PUT', { content });
                closeModal();
                await refreshStatus();
                showToast('Config saved', 'success');
            } catch (e) {
                showToast('Failed to save config', 'error');
            }
        }
        
        async function deleteConfig(name) {
            if (!confirm(`Remove region "${name}"?`)) return;
            try {
                await api(`/configs/${name}`, 'DELETE');
                await loadConfigs();
                showToast('Region removed', 'success');
            } catch (e) {
                showToast('Failed to remove region', 'error');
            }
        }
        
        async function uploadConfig(file) {
            if (!file) return;
            try {
                const formData = new FormData();
                formData.append('file', file);
                showToast('Uploading...', 'success');
                await api('/configs', 'POST', formData);
                await loadConfigs();
                showToast('Region deployed', 'success');
                document.getElementById('file-input').value = '';
            } catch (e) {
                showToast('Upload failed', 'error');
            }
        }
        
        function setupDragDrop() {
            const zone = document.getElementById('upload-zone');
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
                zone.addEventListener(event, e => { e.preventDefault(); e.stopPropagation(); });
            });
            ['dragenter', 'dragover'].forEach(event => {
                zone.addEventListener(event, () => zone.classList.add('dragover'));
            });
            ['dragleave', 'drop'].forEach(event => {
                zone.addEventListener(event, () => zone.classList.remove('dragover'));
            });
            zone.addEventListener('drop', e => {
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.conf')) {
                    uploadConfig(file);
                } else {
                    showToast('Invalid file type', 'error');
                }
            });
        }
        
        function closeModal() {
            document.getElementById('edit-modal').classList.remove('active');
            currentEditConfig = null;
        }
        
        function showModal(title, body) {
            document.getElementById('info-modal-title').textContent = title;
            document.getElementById('info-modal-body').innerHTML = body;
            document.getElementById('info-modal').classList.add('active');
        }
        
        function closeInfoModal() {
            document.getElementById('info-modal').classList.remove('active');
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }
        
        // Settings Functions
        async function loadSettings() {
            try {
                const response = await api('/settings');
                
                // Store config names globally
                configNames = response.config_names || {};
                lastAvailableConfigs = response.available_configs || [];
                settingsLoaded = true;
                
                // Populate config dropdown
                const select = document.getElementById('autostart-config');
                select.innerHTML = `<option value="">${t('selectConfig')}</option>`;
                
                if (response.available_configs) {
                    response.available_configs.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        const displayName = configNames[name] || name;
                        option.textContent = displayName;
                        if (name === response.autostart_config) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                    
                    // Render config names list
                    renderConfigNamesList(response.available_configs);
                }
                
                document.getElementById('autostart-toggle').checked = response.autostart || false;
                updateAutostartStatusUI(response.autostart, response.autostart_config);
                
                // Re-render configs with custom names
                if (allConfigs.length > 0) {
                    renderConfigs(allConfigs);
                }
            } catch (e) {
                console.error('Failed to load settings:', e);
            }
        }
        
        function renderConfigNamesList(configs) {
            lastAvailableConfigs = configs || [];
            const list = document.getElementById('config-names-list');
            if (!configs || configs.length === 0) {
                list.innerHTML = `<p style="color: var(--text-muted);">${t('noRegions')}</p>`;
                return;
            }
            
            // Get country info for each config
            const configCountries = {};
            allConfigs.forEach(c => {
                configCountries[c.name] = c.country;
            });
            
            list.innerHTML = configs.map(name => {
                const country = configCountries[name];
                const flag = country?.flag || 'üåç';
                const customName = configNames[name] || '';
                return `
                    <div class="config-name-item">
                        <div class="config-original">
                            <span class="flag">${flag}</span>
                            <span>${name}</span>
                        </div>
                        <span class="arrow">‚Üí</span>
                        <input type="text" 
                               id="name-${name}" 
                               value="${customName}" 
                               placeholder="${t('enterCustomName')}">
                    </div>
                `;
            }).join('');
            
            // Parse emojis with Twemoji
            if (typeof twemoji !== 'undefined') {
                twemoji.parse(list);
            }
        }
        
        async function saveConfigNames() {
            const inputs = document.querySelectorAll('.config-name-item input');
            const newNames = {};
            
            inputs.forEach(input => {
                const configName = input.id.replace('name-', '');
                const customName = input.value.trim();
                if (customName) {
                    newNames[configName] = customName;
                }
            });
            
            try {
                showToast('Saving names...', 'success');
                await api('/settings/config-names', 'POST', { config_names: newNames });
                configNames = newNames;
                
                // Re-render configs with new names
                if (allConfigs.length > 0) {
                    renderConfigs(allConfigs);
                    updateActiveSummary();
                }
                
                // Update autostart dropdown directly
                updateAutostartDropdown();
                
                showToast('Names saved!', 'success');
            } catch (e) {
                showToast('Failed to save names', 'error');
                console.error(e);
            }
        }
        
        function updateAutostartDropdown() {
            const select = document.getElementById('autostart-config');
            const currentValue = select.value;
            
            select.innerHTML = `<option value="">${t('selectConfig')}</option>`;
            
            lastAvailableConfigs.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                // Wenn kein custom name existiert, zeige den Original-Dateinamen
                option.textContent = configNames[name] || name;
                if (name === currentValue) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }
        
        async function clearAllNames() {
            if (!confirm('Clear all custom names?')) return;
            
            try {
                await api('/settings/config-names', 'POST', { config_names: {} });
                configNames = {};
                
                // Clear inputs
                document.querySelectorAll('.config-name-item input').forEach(input => {
                    input.value = '';
                });
                
                // Re-render
                if (allConfigs.length > 0) {
                    renderConfigs(allConfigs);
                    updateActiveSummary();
                }
                
                // Update dropdown to show original names
                updateAutostartDropdown();
                showToast('Names cleared', 'success');
            } catch (e) {
                showToast('Failed to clear names', 'error');
            }
        }
        
        function updateAutostartStatusUI(enabled, configName) {
            const status = document.getElementById('autostart-status');
            const statusText = document.getElementById('autostart-status-text');
            const toggleStatus = document.getElementById('autostart-toggle-status');
            
            if (enabled && configName) {
                status.classList.add('active');
                statusText.textContent = `Autostart: ${configName}`;
                toggleStatus.textContent = 'ON';
                toggleStatus.classList.remove('inactive');
                toggleStatus.classList.add('active');
            } else {
                status.classList.remove('active');
                statusText.textContent = 'Autostart Disabled';
                toggleStatus.textContent = 'OFF';
                toggleStatus.classList.remove('active');
                toggleStatus.classList.add('inactive');
            }
        }
        
        function toggleAutostartPreview() {
            const enabled = document.getElementById('autostart-toggle').checked;
            const toggleStatus = document.getElementById('autostart-toggle-status');
            
            toggleStatus.textContent = enabled ? 'ON' : 'OFF';
            toggleStatus.classList.toggle('active', enabled);
            toggleStatus.classList.toggle('inactive', !enabled);
        }
        
        async function saveAutostartSettings() {
            const autostartEnabled = document.getElementById('autostart-toggle').checked;
            const autostartConfig = document.getElementById('autostart-config').value;
            
            if (autostartEnabled && !autostartConfig) {
                showToast('Please select a config', 'error');
                return;
            }
            
            try {
                showToast('Saving settings...', 'success');
                
                const response = await api('/settings/autostart', 'POST', {
                    autostart: autostartEnabled,
                    autostart_config: autostartConfig
                });
                
                updateAutostartStatusUI(autostartEnabled, autostartConfig);
                showToast('Autostart settings saved!', 'success');
            } catch (e) {
                showToast('Failed to save settings', 'error');
                console.error(e);
            }
        }
        
        // Load settings on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Set language selector to saved language
            document.getElementById('language-select').value = currentLang;
            updateAllTranslations();
            
            refreshStatus();
            await loadConfigs(); // Load configs first to get allConfigs with flags
            await loadSettings(); // Then load settings which needs allConfigs
            loadLogs();
            setupDragDrop();
            setInterval(refreshStatus, 10000);
            setInterval(updateRegionClock, 1000);
            setInterval(() => {
                if (allConfigs.length > 0) {
                    renderConfigs(allConfigs);
                    updateActiveSummary();
                }
            }, 60000);
            
            // Parse all emojis on page with Twemoji for cross-browser support
            if (typeof twemoji !== 'undefined') {
                twemoji.parse(document.body);
            }
        });
        
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') { closeModal(); closeInfoModal(); }
        });
    </script>
</body>
</html>
